<html>
  <head>
    <script src="js/jquery-1.8.3.js"></script>
    <script src="js/localStorageInterface.js"></script>
    <script src="js/wordBank.js"></script>
    <script>
      //API Url
      var API_KEY = "721c7f71-22ff-48d9-80fa-2489ea2a009c"
      var DICT_API = "http://www.dictionaryapi.com/api/v1/references/collegiate/xml" +
        "/%query%?key=" + API_KEY;

      //function lookUpWord(query, callback) {
        //var req = new XMLHttpRequest();
        //req.onreadystatechange = function() {
          //if (req.readyState == 4 && req.status == 200) {
            //var xml = $.parseXML(req.responseText),
            //$xml = $( xml ),
            //$test = $xml.find('def');
            //var report = $test.text();
          //}
        //}
      
        //var url = DICT_API.replace("%query%", query);
        //req.open('GET', url, true);
        //req.send();

      //chrome.extension.onMessage.addListener(function(request, sender, callback) {
        //if (request.method == 'lookup') {
          //Lookup word
          //var query = request.arg;
          
          //lookUpWord(request.arg, function(resp) {
           // callback(resp);
         // });
       // }
      //}

      var clickHandler = function(e) {
  
    //add the word and definition to the database with timestamp
      //var API_KEY = "721c7f71-22ff-48d9-80fa-2489ea2a009c";
      var word = e.selectionText.toLowerCase();
      var req = new XMLHttpRequest();

      req.open("GET", 
       "http://www.dictionaryapi.com/api/v1/references" +
       "/collegiate/xml/" + word +
       "?key=" + API_KEY,
       true);

      req.onreadystatechange = function() {
          if (req.readyState == 4 && req.status == 200) {

      var xml = $.parseXML(req.responseText),
      $xml = $( xml ),
      $test = $xml.find('def');

      alert($test.text());
          }
      }

      req.send();

      }

      chrome.contextMenus.create({
        "title": "Store word",
        "contexts": ["selection"],
        "onclick" : clickHandler
      });

    </script>
  </head>
</html>
